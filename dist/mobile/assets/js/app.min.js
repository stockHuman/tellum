(function(){"use strict";function a(){document.getElementById("loader").classList.add("loaded"),c()}function b(){if(navigator.geolocation){const b=document.getElementById("meta");let c,d=d=>{c=d,h=d,b.innerHTML="You are here<br>"+c.coords.latitude+" | "+c.coords.longitude,a()};navigator.geolocation.getCurrentPosition(d,c=>{console.log(c),b.innerHTML="Could't find you",a()})}else console.log("Geolocation is not supported for this Browser/OS."),meta.innerHTML="You are there<br>(Geolocation unavailable or denied.)",a()}function c(){if(navigator.mediaDevices.getUserMedia){var a=[];navigator.mediaDevices.getUserMedia({audio:!0}).then(function(b){var c=new MediaRecorder(b);d(b),j.onclick=function(){g?(c.stop(),j.innerHTML="Record"):(c.start(),j.innerHTML="Recording",setTimeout(function(){"recording"==c.state&&(c.stop(),j.innerHTML="Record",j.classList.toggle("rec"),g=!g)},3e4)),console.log(c.state),j.classList.toggle("rec"),g=!g},k.onclick=function(){0<i&&e()},c.onstop=function(){var b=new Blob(a,{type:"audio/ogg; codecs=opus"});a=[];window.URL.createObjectURL(b);console.info(b.size+" bytes, or "+b.size/1e6+"mb");let c=new FormData,d={lat:h.coords.latitude,lon:h.coords.longitude},e=new Date().toISOString().slice(0,19).replace("T"," ");c.append("meta",JSON.stringify(d)),c.append("datetime",e),c.append("sound",b,b.size+".wav"),axios.post("https://localhost/tellum/api.php/sounds/",c,{headers:{"content-type":"multipart/form-data"}}).then(a=>{console.log(a),i+=1,k.style.display="block"}).catch(a=>{console.warn(a)})},c.ondataavailable=function(b){a.push(b.data)}},function(a){console.log("The following error occured: "+a)})}else console.warn("getUserMedia not supported on your browser!")}function d(a){function b(a,b,c){var d=Math.sin,e=Math.cos,h=Math.PI;this.angle=2*Math.random()*h,this.radius=Math.random(),this.opacity=(5*Math.random()+2)/10,this.distance=1/this.opacity*c,this.speed=3e-5*this.distance,this.position={x:a+this.distance*e(this.angle),y:b+this.distance*d(this.angle)},this.draw=function(){f.fillStyle=g?"rgba(249,220,92,"+this.opacity+")":"rgba(244,255,253,"+this.opacity+")",f.beginPath(),f.arc(this.position.x,this.position.y,this.radius,0,2*h,!1),f.fill(),f.closePath()},this.update=function(){this.angle+=this.speed,this.position={x:a+this.distance*e(this.angle),y:b+this.distance*d(this.angle)},this.draw()}}function c(a,c){this.position={x:a,y:c},this.radius=60,this.count=h?100:2e3,this.particles=[];for(let d=0;d<this.count;d++)this.particles.push(new b(this.position.x,this.position.y,this.radius))}function d(){o.getByteTimeDomainData(q),f.fillStyle="#011936",f.fillRect(0,0,j,k),f.lineWidth=2,f.strokeStyle=g?"#ED254E":"#F4FFFD",f.beginPath();let a=0;for(let d=0;d<p;d++){var b=q[d]/128,c=b*k/4+k/4;0==d?f.moveTo(a,c):f.lineTo(a,c),a+=1*j/p}f.lineTo(e.width,e.height/2),f.stroke(),l.update(),requestAnimFrame(d)}const e=document.getElementById("visualizer"),f=e.getContext("2d"),h=/Mobi/.test(navigator.userAgent);window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)};const i=window.devicePixelRatio;e.width=i*window.innerWidth,e.height=i*window.innerHeight,e.style.width=window.innerWidth+"px",e.style.height=window.innerHeight+"px";const j=window.innerWidth,k=window.innerHeight;f.scale(i,i),c.prototype={update:function(){for(let a=0;a<this.count;a++)this.particles[a].update()}};var l=new c(j/2,k/2),m=n.createMediaStreamSource(a),o=n.createAnalyser();o.fftSize=512;var p=o.frequencyBinCount,q=new Uint8Array(p);m.connect(o),d()}function e(){let a="data:";const b=function(a){a=a.split(",");for(var b=a[0].split(":")[1].split(";")[0],c=atob(a[1]),d=c.length,e=new ArrayBuffer(d),f=new Uint8Array(e),g=0;g<d;g++)f[g]=c.charCodeAt(g);return new Blob([f],{type:b})};axios.get("https://localhost/tellum/api.php/sounds/?columns=id").then(c=>{let d=c.data.sounds.records,e=d[0][0];0>d.length||1===d.length||(e=d[Math.floor(Math.random()*d.length)][0]),console.log("playing audio ID: "+e),axios.get("https://localhost/tellum/api.php/sounds/"+e).then(c=>{a+=c.data.sound_type+";base64,"+c.data.sound,m.appendChild(document.createTextNode("Playing audio ID #"+e));let d=document.createElement("audio"),f=URL.createObjectURL(b(a));d.src=f,d.load(),d.autoplay=!0})}),i-=1,0==i}function f(){p.classList.toggle("info-hidden"),q=!q,o.innerHTML=q?"close":"info"}let g=!1,h="",i=0;const j=document.getElementById("record"),k=document.getElementById("listen"),l=document.querySelector(".main"),m=document.querySelector(".datalog"),n=new(window.AudioContext||webkitAudioContext);document.addEventListener("DOMContentLoaded",function(){b()});const o=document.getElementById("info-toggle"),p=document.getElementById("info");let q=!1;o.addEventListener("click",function(){f()}),p.addEventListener("click",function(){f()})})();