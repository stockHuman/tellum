<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width,initial-scale=1">
		<meta name="theme-color" content="#011936">
		<meta name="msapplication-TileColor" content="#011936">
		<meta name="msapplication-TileImage" content="..assets/img/icons/ms-icon-144x144.png">

		<link rel="stylesheet" href="assets/css/style.css" type="text/css">
		<link rel="apple-touch-icon" sizes="57x57" href="..assets/img/icons/apple-icon-57x57.png">
		<link rel="apple-touch-icon" sizes="60x60" href="..assets/img/icons/apple-icon-60x60.png">
		<link rel="apple-touch-icon" sizes="72x72" href="..assets/img/icons/apple-icon-72x72.png">
		<link rel="apple-touch-icon" sizes="76x76" href="..assets/img/icons/apple-icon-76x76.png">
		<link rel="apple-touch-icon" sizes="114x114" href="..assets/img/icons/apple-icon-114x114.png">
		<link rel="apple-touch-icon" sizes="120x120" href="..assets/img/icons/apple-icon-120x120.png">
		<link rel="apple-touch-icon" sizes="144x144" href="..assets/img/icons/apple-icon-144x144.png">
		<link rel="apple-touch-icon" sizes="152x152" href="..assets/img/icons/apple-icon-152x152.png">
		<link rel="apple-touch-icon" sizes="180x180" href="..assets/img/icons/apple-icon-180x180.png">
		<link rel="icon" type="image/png" sizes="192x192"  href="..assets/img/icons/android-icon-192x192.png">
		<link rel="icon" type="image/png" sizes="32x32" href="..assets/img/icons/favicon-32x32.png">
		<link rel="icon" type="image/png" sizes="96x96" href="..assets/img/icons/favicon-96x96.png">
		<link rel="icon" type="image/png" sizes="16x16" href="..assets/img/icons/favicon-16x16.png">
		<link rel="manifest" href="..assets/img/icons/manifest.json">

		<title>Tellum âšŒ Node</title>
		<style>
			.list-item {
				color: white;
				opacity: 0.9;
				margin: 10px 1rem;
				padding: 10px;
				list-style-type: none;
			}
			ul {list-style-type: none; margin:0;}
			main {position: relative;}
		</style>
	</head>

	<body>
		<header>
			<img src="assets/img/logo.svg" alt="tellum logo" id="logo">
		</header>

		<main>
			<button id="fetch">Get items</button>
			<ul id="list"></ul>
		</main>

		<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
		<script>
			const server = 'https://tellum.fun/api.php/sounds/'
			const list = document.getElementById('list')
			document.getElementById('fetch').addEventListener('click', () => {
				axios.get(server + '?columns=id').then(response => {
					// retrieve entire list
					let all = response.data.sounds.records
					let selected = all[0][0]

					all.forEach(function (item, index, all) {
						let i = document.createElement('li')
						i.classList = 'list-item'
						let desc = document.createElement('p')
						let listenbtn = document.createElement('button')
						listenbtn.innerHTML = 'listen'

						let base64audio = 'data:'
						let randomAudio = 0

						const dataURItoBlob = function (dataURI) {
							// Split the input to get the mime-type and the data itself
							dataURI = dataURI.split( ',' );

							// First part contains data:audio/ogg;base64 from which we only need audio/ogg
							var type = dataURI[ 0 ].split( ':' )[ 1 ].split( ';' )[ 0 ];

							// Second part is the data itself and we decode it
							var byteString = atob( dataURI[ 1 ] );
							var byteStringLen = byteString.length;

							// Create ArrayBuffer with the byte string and set the length to it
							var ab = new ArrayBuffer( byteStringLen );

							// Create a typed array out of the array buffer representing each character from as a 8-bit unsigned integer
							var intArray = new Uint8Array( ab );
							for ( var i = 0; i < byteStringLen; i++ ) {
								intArray[ i ] = byteString.charCodeAt( i );
							}

							return new Blob( [ intArray ], {type: type} );
						}

						listenbtn.addEventListener('click', () => {
							axios.get(server + all[index]).then(response => {
								base64audio += response.data.sound_type + ';base64,' + response.data.sound;
								// $('#source').text('Source: ' + base64audio);

								let audio = document.createElement('audio');
								document.body.appendChild(audio)
								let audioURL = URL.createObjectURL(dataURItoBlob(base64audio));
								// record.style.display = 'none';

								audio.src = audioURL;
								audio.load();
								audio.autoplay = true;
								audio.play()
							})
						})

						desc.innerHTML = all[index] + '  - '
						desc.appendChild(listenbtn)
						i.appendChild(desc)
						list.appendChild(i)
					})
				})
			})
		</script>
	</body>
</html>
