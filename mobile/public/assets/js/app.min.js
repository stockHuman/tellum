(function(){'use strict';function a(){if(navigator.geolocation){const a=document.getElementById('meta');let c;navigator.geolocation.getCurrentPosition((d)=>{c=d,g=d,a.innerHTML=c.coords.latitude+' | '+c.coords.longitude,b()},(a)=>{console.log(a)})}else console.log('Geolocation is not supported for this Browser/OS.')}function b(){if(navigator.mediaDevices.getUserMedia){var a=[];navigator.mediaDevices.getUserMedia({audio:!0}).then(function(b){var k=new MediaRecorder(b);c(b),i.onclick=function(){f?(k.stop(),i.innerHTML='Record'):(k.start(),i.innerHTML='Recording'),console.log(k.state),i.classList.toggle('rec'),f=!f},j.onclick=function(){0<h&&d()},k.onstop=function(){var b=new Blob(a,{type:'audio/ogg; codecs=opus'});a=[];window.URL.createObjectURL(b);console.info(b.size+' bytes, or '+b.size/1e6+'mb');let c=new FormData,d={lat:g.coords.latitude,lon:g.coords.longitude},f=new Date().toISOString().slice(0,19).replace('T',' ');c.append('meta',JSON.stringify(d)),c.append('datetime',f),c.append('sound',b,b.size+'.wav'),axios.post(e,c,{headers:{"content-type":'multipart/form-data'}}).then((a)=>{console.log(a),h+=1,$('#listen').show()}).catch((a)=>{console.warn(a)})},k.ondataavailable=function(b){a.push(b.data)}},function(a){console.log('The following error occured: '+a)})}else console.warn('getUserMedia not supported on your browser!')}function c(a){function b(a,b,c){var d=Math.sin,e=Math.cos,h=Math.PI;this.angle=2*Math.random()*h,this.radius=Math.random(),this.opacity=(5*Math.random()+2)/10,this.distance=1/this.opacity*c,this.speed=3e-5*this.distance,this.position={x:a+this.distance*e(this.angle),y:b+this.distance*d(this.angle)},this.draw=function(){g.fillStyle=f?'rgba(249,220,92,'+this.opacity+')':'rgba(244,255,253,'+this.opacity+')',g.beginPath(),g.arc(this.position.x,this.position.y,this.radius,0,2*h,!1),g.fill(),g.closePath()},this.update=function(){this.angle+=this.speed,this.position={x:a+this.distance*e(this.angle),y:b+this.distance*d(this.angle)},this.draw()}}function c(a,c){this.position={x:a,y:c},this.radius=60,this.count=h?100:2e3,this.particles=[];for(let d=0;d<this.count;d++)this.particles.push(new b(this.position.x,this.position.y,this.radius))}function d(){o.getByteTimeDomainData(q),g.fillStyle='#011936',g.fillRect(0,0,j,k),g.lineWidth=2,g.strokeStyle=f?'#ED254E':'#F4FFFD',g.beginPath();let a=0;for(let d=0;d<p;d++){var b=q[d]/128,c=b*k/4+k/4;0===d?g.moveTo(a,c):g.lineTo(a,c),a+=1*j/p}g.lineTo(e.width,e.height/2),g.stroke(),m.update(),requestAnimFrame(d)}const e=document.getElementById('visualizer'),g=e.getContext('2d'),h=/Mobi/.test(navigator.userAgent);window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)};const i=window.devicePixelRatio;e.width=i*window.innerWidth,e.height=i*window.innerHeight,e.style.width=window.innerWidth+'px',e.style.height=window.innerHeight+'px';const j=window.innerWidth,k=window.innerHeight;g.scale(i,i),c.prototype={update:function(){for(let a=0;a<this.count;a++)this.particles[a].update()}};var m=new c(j/2,k/2),n=l.createMediaStreamSource(a),o=l.createAnalyser();o.fftSize=512;var p=o.frequencyBinCount,q=new Uint8Array(p);n.connect(o),d()}function d(){let a='data:';const b=function(a){a=a.split(',');for(var b=a[0].split(':')[1].split(';')[0],c=atob(a[1]),d=c.length,e=new ArrayBuffer(d),f=new Uint8Array(e),g=0;g<d;g++)f[g]=c.charCodeAt(g);return new Blob([f],{type:b})};axios.get(e+'?columns=id').then((c)=>{let d=c.data.sounds.records,f=d[0][0];0>d.length||1===d.length||(f=d[Math.floor(Math.random()*d.length)][0]),console.log('playing audio ID: '+f),axios.get(e+f).then((c)=>{a+=c.data.sound_type+';base64,'+c.data.sound;let d=document.createElement('audio'),e=URL.createObjectURL(b(a));d.src=e,d.load(),d.autoplay=!0})}),h-=1}const e='https://c351.michaelhemingway.com/projects/tellum/api.php/sounds/';let f=!1,g='',h=0;const i=document.getElementById('record'),j=document.getElementById('listen'),k=document.querySelector('.main'),l=new(window.AudioContext||webkitAudioContext);$(document).ready(function(){a()})})();